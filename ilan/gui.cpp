#include <dos.h>
#include <stdlib.h>
#include <alloc.h>

extern struct POINT p;

/*
	MOUSE ROUTINES
*/

// mouse functions

void MouseOn();
void MouseOff();
int MouseDownL(struct POINT *p);
int MouseDownR(struct POINT *p);
void MouseLoc(struct POINT *p);
int InitMouse(void);
void ArrowCursor(void);
void WaitCursor(void);
void FingerCursor(void);
void MoveMouse(struct POINT *p);


int FLAG;


int InitMouse(void)
{
	union REGS r;

	r.x.ax = 0;
	int86(0x33,&r,&r);

	return r.x.ax;
}


void MouseOff(void)
{
	union REGS r;

	r.x.ax = 2;
	int86(0x33,&r,&r);
}

void MouseOn(void)
{
	union REGS r;

	r.x.ax = 1;
	int86(0x33,&r,&r);
}

int MouseDownL(struct POINT *p)
{
	union REGS r;

	if (p->x>600 && FLAG)
		FingerCursor();
	else  if (!FLAG && p->x<=600)
		ArrowCursor();

	r.x.ax = 3;
	int86(0x33,&r,&r);

	p->x = r.x.cx;
	p->y = r.x.dx;

	return (r.x.bx & 0x01);
}

int MouseDownR(struct POINT *p)
{
	union REGS r;

	r.x.ax = 3;
	int86(0x33,&r,&r);

	p->x = r.x.cx;
	p->y = r.x.dx;

	return (r.x.bx & 0x02);
}

void MoveMouse(struct POINT *p)
{
	union REGS r;


	r.x.ax = 4;
	r.x.cx = p->x;
	r.x.dx = p->y;

	int86(0x33,&r,&r);
}

void MouseLoc(struct POINT *p)
{
	union REGS r;

	r.x.ax = 3;
	int86(0x33,&r,&r);

	p->x = r.x.cx;
	p->y = r.x.dx;
}

void ArrowCursor(void)
{
	union REGS r;
	struct SREGS sr;
	static char cursor[] =
	{
		0xff,0x3f,0xff,0x1f,0xff,0x0f,0xff,0x07,
		0xff,0x03,0xff,0x01,0xff,0x00,0x7f,0x00,
		0x3f,0x00,0x1f,0x00,0xff,0x01,0xff,0x10,
		0xff,0x30,0x7f,0xf8,0x7f,0xf8,0x7f,0xfc,
		0x00,0x00,0x00,0x40,0x00,0x60,0x00,0x70,
		0x00,0x78,0x00,0x7c,0x00,0x7e,0x00,0x7f,
		0x80,0x7f,0x00,0x7c,0x00,0x6c,0x00,0x46,
		0x00,0x06,0x00,0x03,0x00,0x03,0x00,0x00};

	r.x.ax = 0x0009;
	r.x.bx = 0;
	r.x.cx = 0;
	r.x.dx = FP_OFF(cursor);
	sr.es  = FP_SEG(cursor);

	int86x(0x33,&r,&r,&sr);

	FLAG = 1;

}

void WaitCursor(void)
{
	union REGS r;
	struct SREGS sr;
	static char cursor[] =
	{
		0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x80,
		0x03,0xc0,0x07,0xe0,0x0f,0xf0,0x07,0xe0,
		0x03,0xc0,0x01,0x80,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,
		0x00,0x00,0xfe,0x7f,0x06,0x60,0x0c,0x30,
		0x18,0x18,0x30,0x0c,0x60,0x06,0xc0,0x03,
		0x60,0x06,0x30,0x0c,0x98,0x19,0xcc,0x33,
		0xe6,0x67,0xfe,0x7f,0x00,0x00,0x00,0x00};

	r.x.ax = 0x0009;
	r.x.bx = 7;
	r.x.cx = 7;
	r.x.dx = FP_OFF(cursor);
	sr.es  = FP_SEG(cursor);
	int86x(0x33,&r,&r,&sr);
}

void FingerCursor(void)
{
	union REGS r;
	struct SREGS sr;
	static char cursor[] =
	{
		0xff,0xf3,0xff,0xff,0xff,0xe1,0xff,0xe1,
		0xff,0xe1,0xff,0xe0,0x49,0xe0,0x00,0x80,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x80,0x00,0xc0,0x01,0xc0,
		0x00,0x00,0x00,0x0c,0x00,0x0c,0x00,0x0c,
		0x00,0x0c,0x00,0x0c,0x00,0x0f,0x00,0x0f,
		0xfe,0x3d,0xb6,0x6d,0xb6,0x6d,0xb6,0x6f,
		0xfe,0x3f,0xfe,0x1f,0xfc,0x1f,0xf8,0x0f};

	r.x.ax = 0x0009;
	r.x.bx = 7;
	r.x.cx = 7;
	r.x.dx = FP_OFF(cursor);
	sr.es  = FP_SEG(cursor);
	int86x(0x33,&r,&r,&sr);

	FLAG = 0;
}


void OpenWindow(WINDOW *w,RECT *r);
{
	int size;

	w->frame.left = r->left-1;
	w->frame.top  = r->top-1;
	w->frame.right = r->right+DROPSHADOW+1;
	w->frame.bottom = r->bottom+DROPSHADOW+1;

	if ((size=buffersize(&w->frame))== -1)
		return 0;

	w->head.next = NULL;
	w->head.type= inWindow;
	if (w->back=malloc(size)) != NULL){
		MouseOff();
		setwritemode
}